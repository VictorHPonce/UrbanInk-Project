<div class="space-y-6 animate-in fade-in duration-500">

  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end gap-4 border-b border-gray-200 pb-6">
    <div>
      <h1 class="text-3xl font-black text-slate-900 tracking-tight">Productos</h1>
      <p class="text-sm text-slate-500 mt-1">Gestiona tu catálogo, controla el stock y actualiza precios.</p>
    </div>

    <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">

      <div class="relative w-full sm:w-64 group">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <app-icon name="search" class="h-4 w-4 text-gray-400 group-focus-within:text-indigo-500 transition-colors" />
        </div>
        <input [formControl]="searchControl" type="text" placeholder="Buscar producto..."
          class="block w-full pl-10 pr-3 py-2.5 border border-gray-200 rounded-xl leading-5 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-sm shadow-sm">
      </div>

      <a routerLink="new"
        class="inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-bold rounded-xl text-white bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 shadow-sm hover:shadow-md transition-all">
        <app-icon name="plus" class="w-5 h-5 mr-2 -ml-1" />
        Nuevo Producto
      </a>
    </div>
  </div>

  <div class="bg-white border border-gray-200 rounded-2xl shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] overflow-hidden">

    @if (store.isLoading()) {
    <div class="p-6 space-y-6">
      @for (i of [1,2,3,4,5]; track i) {
      <div class="flex items-center space-x-4 animate-pulse">
        <div class="h-12 w-12 bg-slate-100 rounded-lg"></div>
        <div class="flex-1 space-y-2">
          <div class="h-4 bg-slate-100 rounded w-1/4"></div>
          <div class="h-3 bg-slate-50 rounded w-1/6"></div>
        </div>
      </div>
      }
    </div>
    } @else {
    <div class="overflow-x-auto custom-scrollbar">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50/50">
          <tr>
            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">
              Producto</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">
              Categoría</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Precio
            </th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Stock
            </th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Estado
            </th>
            <th scope="col" class="relative px-6 py-4"><span class="sr-only">Acciones</span></th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
          @for (product of store.products(); track product.id) {
          <tr class="hover:bg-gray-50/80 transition-colors group">

            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="shrink-0 h-12 w-12 relative">
                  <img [src]="product.imageUrl"
                    class="h-12 w-12 rounded-xl object-cover border border-gray-100 shadow-sm" [alt]="product.name">
                </div>
                <div class="ml-4">
                  <div class="text-sm font-bold text-gray-900 group-hover:text-indigo-600 transition-colors">{{
                    product.name }}</div>
                  <div class="text-xs text-gray-500 font-mono mt-0.5">SKU: {{ product.id }}</div>
                </div>
              </div>
            </td>

            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800 border border-slate-200">
                {{ product.category }}
              </span>
            </td>

            <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">
              {{ product.price | currency }}
            </td>

            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center gap-2">
                <div class="text-sm font-medium" [class.text-red-600]="product.stock < 5"
                  [class.text-gray-900]="product.stock >= 5">
                  {{ product.stock }} un.
                </div>
                @if(product.stock < 5) { <span class="relative flex h-2.5 w-2.5">
                  <span
                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"></span>
                  </span>
                  }
              </div>
            </td>

            <td class="px-6 py-4 whitespace-nowrap">
              <button (click)="store.toggleStatus({ id: product.id, isActive: !product.isActive })" [class]="product.isActive 
                      ? 'bg-emerald-50 text-emerald-700 border-emerald-100 hover:bg-emerald-100' 
                      : 'bg-gray-50 text-gray-500 border-gray-200 hover:bg-gray-100'"
                class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full items-center gap-1.5 border transition-colors cursor-pointer">
                <span [class]="product.isActive ? 'bg-emerald-500' : 'bg-gray-400'"
                  class="w-1.5 h-1.5 rounded-full"></span>
                {{ product.isActive ? 'Activo' : 'Inactivo' }}
              </button>
            </td>

            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <div class="flex justify-end gap-3 opacity-0 group-hover:opacity-100 transition-opacity">

                <a [routerLink]="['edit', product.id]" class="text-indigo-600 hover:text-indigo-900 p-1 hover:bg-indigo-50 rounded transition-colors"
                  title="Editar">
                  <app-icon name="edit" class="w-5 h-5" />
                </a>

                @if (product.isActive) {
                <a (click)="onDelete(product)"
                  class="text-gray-400 hover:text-red-600 p-1 hover:bg-red-50 rounded transition-colors"
                  title="Desactivar producto">
                  <app-icon name="trash" class="w-5 h-5" />
                </a>
                }
              </div>
            </td>
          </tr>
          } @empty {
          <tr>
            <td colspan="6" class="px-6 py-16 text-center">
              <div class="flex flex-col items-center justify-center text-gray-500">
                <div class="bg-gray-50 p-4 rounded-full mb-3">
                  <app-icon name="clipboard-search" class="w-8 h-8 text-gray-400" />
                </div>
                <p class="text-base font-medium text-gray-900">No se encontraron productos</p>
                <p class="text-sm mt-1">Intenta con otros términos o crea uno nuevo.</p>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <div
      class="bg-gray-50 border-t border-gray-200 px-6 py-4 flex flex-col sm:flex-row items-center justify-between gap-4">
      <span class="text-xs font-medium text-gray-500">
        Viendo <span class="font-bold text-gray-900">{{ store.startItem() }} - {{ store.endItem() }}</span> de {{
        store.totalItems() }} resultados
      </span>
      <div class="flex gap-2">
        <button [disabled]="store.currentPage() === 1" (click)="store.setPage(store.currentPage() - 1)"
          class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-xs font-bold text-gray-700 hover:bg-gray-50 hover:text-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          Anterior
        </button>
        <button [disabled]="store.currentPage() === store.totalPages()" (click)="store.setPage(store.currentPage() + 1)"
          class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-xs font-bold text-gray-700 hover:bg-gray-50 hover:text-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          Siguiente
        </button>
      </div>
    </div>
    }
  </div>
</div>